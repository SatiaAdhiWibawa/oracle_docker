-- INSERT INTO SELECT
-- INSERT INTO SELECT adalah perinta SQL yang digunakan untuk menyalin data dari satu tabel ke tabel lain.
-- Perintah ini memiliki dua cara penulisan yang berbeda, yaitu:
-- 1. INSERT INTO SELECT
-- 2. INSERT INTO SELECT VALUES

-- CONTOHNYA
-- INSERT INTO TARGET_TABLE (column1, column2, column3, ...)
-- SELECT column1, column2, column3, ...
-- FROM SOURCE_TABLE
-- WHERE condition;

CREATE TABLE SALES(
    CUSTOMER_ID NUMBER,
    PRODUCT_ID NUMBER,
    ORDER_DATE DATE NOT NULL,
    TOTAL NUMBER(10, 2) DEFAULT 0 NOT NULL,
    PRIMARY KEY(CUSTOMER_ID, PRODUCT_ID, ORDER_DATE)
);


-- CONTOH UNTUK MEMINDAHKAN DATA DARI TABEL ORDERS DAN ORDER_ITEMS KE TABEL SALES
INSERT INTO SALES(CUSTOMER_ID, PRODUCT_ID, ORDER_DATE, TOTAL)
SELECT CUSTOMER_ID, PRODUCT_ID, ORDER_DATE, SUM(QUANTITY * UNIT_PRICE) AMOUNT
FROM ORDERS O
JOIN ORDER_ITEMS OI ON OI.ORDER_ID = O.ORDER_ID
GROUP BY CUSTOMER_ID, PRODUCT_ID, ORDER_DATE;


SELECT * FROM SALES;


-- CONTOH UNTUK MEMBUAT TABEL SALES_2017 DENGAN DATA KOSONG
-- DARI TABEL SALES DENGAN STRUKTUR YANG SAMA
-- akan menghasilkan tabel baru dengan struktur yang sama dengan tabel SALES tetapi tidak ada data di dalamnya.
CREATE TABLE SALES_2017 AS
SELECT * FROM SALES
WHERE 1=0;

SELECT * FROM SALES_2017;

-- CONTOH UNTUK MEMINDAHKAN DATA DARI TABEL SALES KE TABEL SALES_2017
INSERT INTO SALES_2017
SELECT CUSTOMER_ID, PRODUCT_ID, ORDER_DATE, SUM(QUANTITY * UNIT_PRICE) AMOUNT
FROM ORDERS O
JOIN ORDER_ITEMS OI ON OI.ORDER_ID = O.ORDER_ID
WHERE O.STATUS = 'Shipped'
AND EXTRACT(YEAR FROM ORDER_DATE) = 2017
GROUP BY CUSTOMER_ID, PRODUCT_ID, ORDER_DATE;

SELECT * FROM SALES_2017;


CREATE TABLE CUSTOMER_LISTS(
    LIST_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FIRST_NAME VARCHAR2(50) NOT NULL,
    LAST_NAME VARCHAR2(50) NOT NULL,
    EMAIL VARCHAR2(100) NOT NULL,
    SEND NUMBER(1) DEFAULT 0 NOT NULL,
    SEND_DATE DATE,
    PRIMARY KEY(LIST_ID)
);

INSERT INTO CUSTOMER_LISTS(FIRST_NAME, LAST_NAME, EMAIL, SEND) 
SELECT
    FIRST_NAME, LAST_NAME, EMAIL, 0
FROM CONTACTS;



SELECT * FROM CUSTOMER_LISTS;